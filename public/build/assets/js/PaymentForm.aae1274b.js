var e=(e,t,a)=>new Promise(((r,n)=>{var o=e=>{try{i(a.next(e))}catch(t){n(t)}},s=e=>{try{i(a.throw(e))}catch(t){n(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,s);i((a=a.apply(e,t)).next())}));import{V as t,j as a}from"./app.2137b7fd.js";import{r,b as n}from"./vendor.463d2c8a.js";import{u as o,a as s,C as i}from"./stripe.fe3769f5.js";import{m as l}from"./motion.6f439a0f.js";const d=({order:d,onSuccess:c,onError:u})=>{const m=o(),p=s(),[y,v]=r.useState(!1),[f,g]=r.useState(""),[h,b]=r.useState(""),[x,P]=r.useState(null),[j,w]=r.useState(!1);r.useEffect((()=>{let t=!0;const a=new AbortController;return e(void 0,null,(function*(){var e,r,o,s;try{if(!t)return;v(!0);const e=yield n.post(route("payment.create-intent"),{},{signal:a.signal});if(!t)return;e.data.clientSecret?(g(e.data.clientSecret),b(e.data.paymentIntentId),w(!0)):(P("Failed to get client secret from server"),u("Failed to get client secret from server"))}catch(i){if(!t||n.isCancel(i))return;P((null==(r=null==(e=i.response)?void 0:e.data)?void 0:r.error)||"Failed to initialize payment"),u((null==(s=null==(o=i.response)?void 0:o.data)?void 0:s.error)||"Failed to initialize payment")}finally{t&&v(!1)}})),()=>{t=!1,a.abort()}}),[u]);const S=r.useCallback((t=>e(void 0,null,(function*(){var e,a;try{return(yield n.post(route("payment.validate-method"),{payment_method_id:t})).data}catch(r){return{valid:!1,message:(null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||"Error validating card"}}}))),[]),_=r.useCallback((a=>e(void 0,null,(function*(){var e,r,o,s,l,d;if(a.preventDefault(),m&&p&&f){v(!0),P(null);try{const{error:e,paymentMethod:a}=yield m.createPaymentMethod({type:"card",card:p.getElement(i)});if(e)return void P(e.message);const r=yield S(a.id);if(!r.valid)return P(r.message),void t.error(r.message);const o=yield n.post(route("payment.confirm"),{payment_intent_id:h,payment_method_id:a.id});o.data.success?(t.success("Payment successful!"),c(o.data.order)):(P("Payment failed. Please try again."),u("Payment failed. Please try again."))}catch(y){"invalid_card"===(null==(r=null==(e=y.response)?void 0:e.data)?void 0:r.code)&&t.error(y.response.data.error),P((null==(s=null==(o=y.response)?void 0:o.data)?void 0:s.error)||"Payment failed. Please try again."),u((null==(d=null==(l=y.response)?void 0:l.data)?void 0:d.error)||"Payment failed. Please try again.")}finally{v(!1)}}}))),[m,p,f,h,S,c,u]);return a.jsxs("form",{onSubmit:_,className:"space-y-4",children:[a.jsx("div",{className:"p-4 border border-gray-300 rounded-md bg-white",children:a.jsx(i,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})}),x&&a.jsx("div",{className:"text-red-500 text-sm mt-2",children:x}),a.jsx(l.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:!m||y||!f,className:"w-full bg-pink-600 text-white py-3 px-4 rounded-md hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 text-center font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Processing...":"Pay Now"})]})};export{d as default};
